<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jadwal Sholat & Imsakiyah</title>
  <!-- Google Fonts: Lato untuk judul, Open Sans untuk body -->
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
  <!-- Bootstrap & Select2 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  
  <style>
    /* Overall Background */
    body {
      background-color: #f9fafc;
      font-family: 'Open Sans', sans-serif;
    }
    /* Header */
    .header-section {
      background: linear-gradient(90deg, #6a11cb, #2575fc);
      color: #fff;
      padding: 30px 0;
      text-align: center;
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    .header-section h1 {
      font-family: 'Lato', sans-serif;
      font-size: 2.8rem;
      margin-bottom: 0;
      text-transform: uppercase;
    }
    /* Info Box */
    .info-box {
      background-color: #5e9cfb;
      color: #fff;
      border: 2px solid #2575fc;
      border-radius: 12px;
      padding: 25px;
      margin-top: 20px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
      text-align: center;
    }
    .info-box p {
      margin-bottom: 10px;
    }
    /* Custom Dropdown: Label di kiri, select di kanan */
    .custom-select-city {
      max-width: 400px;
      margin: 0 auto;
    }
    .custom-select-city .d-flex {
      justify-content: flex-start;
      align-items: center;
    }
    .custom-select-city .form-label {
      margin-right: 10px;
      font-weight: 500;
      font-size: 1rem;
    }
    /* Segmented Button Container */
    .btn-group-custom {
      display: inline-flex;
      border: 1px solid #ced4da;
      border-radius: 0.5rem;
      overflow: hidden;
      margin-top: 20px;
      margin-left: 20px;
    }
    /* Tombol Segmented (Flat) */
    .btn-segment {
      background-color: #e0e0e0;
      color: #777;
      border: none;
      border-right: 1px solid #ddd;
      padding: 10px 25px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
    }
    .btn-segment:first-child {
      border-left: 1px solid #ddd;
    }
    .btn-segment:last-child {
      border-right: 1px solid #ddd;
    }
    .btn-segment:hover:not(.active) {
      background-color: #d0d0d0;
    }
    .btn-segment.active {
      background-color: #5e9cfb;
      color: #fff;
      box-shadow: 0 4px 8px rgba(94,156,251,0.3);
    }
    /* Table Container */
    .table-container {
      border: 1px solid #ddd;
      border-radius: 10px;
      background-color: #fff;
      padding: 15px;
      margin-top: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .table-responsive {
      max-height: 70vh;
      overflow-y: auto;
      -ms-overflow-style: none;  /* IE 10+ */
      scrollbar-width: none;  /* Firefox */
    }
    /* Sembunyikan scrollbar untuk browser Webkit (Chrome, Safari, Opera) */
    .table-responsive::-webkit-scrollbar {
      display: none;
    }
    /* Tabel Header (Flat) */
    .table-header th {
      background-color: #5e9cfb;
      color: #fff;
      font-family: 'Lato', sans-serif;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 14px;
      padding: 12px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    /* Tabel Body (Flat Colors) */
    .table tbody td {
      padding: 12px;
      font-size: 14px;
      background-color: #fff;
    }
    .table tbody tr:nth-child(even) td {
      background-color: #f3f5ff;
    }
    .table tbody tr:hover td {
      background-color: #e2e6ea !important;
    }
    .highlight-today td {
      background-color: #ffeaa7 !important;
      color: #000;
      font-weight: bold;
      border-radius: 5px;
    }
    .current-prayer {
      background-color: #ff9f43 !important;
      color: #fff;
      font-weight: bold;
      border-radius: 5px;
    }
    /* Notifikasi Sholat */
    #prayerNotification {
      font-size: 0.9rem;
      color: #ffd700;
      font-weight: 600;
      margin-top: 10px;
      overflow: hidden;
      white-space: nowrap;
      position: relative;
    }
    #prayerNotification span {
      display: inline-block;
      padding-left: 100%;
      animation: marquee 15s linear infinite;
    }
    @keyframes marquee {
      0% { transform: translate(0, 0); }
      100% { transform: translate(-100%, 0); }
    }
    /* Dark Mode */
    .dark-mode {
      background-color: #1b1b1b;
      color: #e8e8e8;
    }
    .dark-mode .header-section {
      background: linear-gradient(90deg, #000, #333);
      box-shadow: 0 4px 10px rgba(255,255,255,0.05);
    }
    .dark-mode .table-container {
      background-color: #2b2b2b;
      border-color: #444;
    }
    .dark-mode .table {
      background-color: #2b2b2b;
      color: #e8e8e8;
    }
    .dark-mode .table-header th {
      background-color: #333;
      border-color: #444;
    }
    .dark-mode .table tbody td {
      border-color: #444;
    }
    .dark-mode .table tbody tr:nth-child(even) td {
      background-color: #272727;
    }
    .dark-mode .table tbody tr:nth-child(odd) td {
      background-color: #2b2b2b;
    }
    .dark-mode .table tbody tr:hover td {
      background-color: #3a3a3a !important;
    }
    .dark-mode .highlight-today td {
      background-color: #ffc107 !important;
      color: #000;
      font-weight: bold;
      border-radius: 5px;
    }
    .dark-mode .current-prayer {
      background-color: #ff8a65 !important;
      color: #000;
      border-radius: 5px;
    }
    .dark-mode .info-box {
      background-color: #333;
      border-color: #666;
    }
    .dark-mode #prayerNotification {
      color: #ffd700;
    }
    /* Select2 Customization */
    .select2-container--default .select2-selection--single {
      border: 2px solid #5e9cfb;
      border-radius: 8px;
      background-color: #fff;
      transition: all 0.3s ease;
      height: 42px !important;
      display: flex;
      align-items: center;
      padding-left: 10px;
      padding-right: 30px;
    }
    .select2-container--default .select2-selection--single:hover {
      box-shadow: 0 0 5px rgba(94,156,251,0.3);
    }
    .select2-container--default .select2-selection--single .select2-selection__arrow {
      top: 50%;
      transform: translateY(-50%);
      right: 10px;
    }
    .select2-container--default .select2-dropdown {
      border: 2px solid #5e9cfb;
      border-radius: 8px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
      margin-top: 2px;
    }
    .select2-container--default .select2-results__option {
      padding: 8px 12px;
      transition: background-color 0.2s ease;
    }
    .select2-container--default .select2-results__option--highlighted {
      background-color: #5e9cfb !important;
      color: #fff !important;
    }
    .dark-mode .select2-container--default .select2-selection--single {
      background-color: #3a3f44;
      color: #e8e8e8;
      border-color: #666;
    }
    .dark-mode .select2-container--default .select2-selection--single:hover {
      box-shadow: 0 0 5px rgba(102,102,102,0.5);
    }
    .dark-mode .select2-container--default .select2-dropdown {
      background-color: #3a3a3a !important;
      border-color: #666 !important;
    }
    .dark-mode .select2-container--default .select2-results__option--highlighted {
      background-color: #666 !important;
      color: #fff !important;
    }
    /* Card Jadwal Harian */
    #hariScheduleCard {
      max-width: 500px;
      margin: 20px auto;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header-section">
    <h1>JADWAL SHOLAT & IMSAKIYAH SELURUH INDONESIA</h1>
  </header>

  <!-- Main Container -->
  <div class="container mt-4">
    <!-- Info Box -->
    <div class="info-box">
      <p id="selectedInfo" class="fw-bold mb-1">Jadwal Sholat untuk Seluruh Indonesia</p>
      <p id="prayerNotification" class="fw-bold mt-2">
        <span id="prayerNotificationText"></span>
      </p>
      <!-- Dropdown Kota -->
      <div class="custom-select-city mt-3">
        <div class="d-flex align-items-center justify-content-start">
          <label for="citySelect" class="form-label me-2">Kota/Kab:</label>
          <select id="citySelect" class="form-select select2" style="max-width:300px;"></select>
        </div>
      </div>
    </div>

    <!-- Segmented Button -->
    <div style="margin-top: 20px; margin-left: 20px;">
      <div id="btnSegmented" class="btn-group-custom">
        <button id="btnHari" class="btn-segment btn-hari active">Hari</button>
        <button id="btnBulan" class="btn-segment btn-bulan">Bulan</button>
      </div>
    </div>

    <!-- Jadwal Hari -->
    <div id="hariContainer" class="mt-3">
      <div id="hariScheduleCard"></div>
    </div>

    <!-- Jadwal Bulan -->
    <div id="bulanContainer" class="mt-3" style="display: none;">
      <div class="table-container">
        <div class="table-responsive">
          <table class="table table-bordered text-center">
            <thead class="table-header">
              <tr>
                <th>Tanggal</th>
                <th>Imsak</th>
                <th>Subuh</th>
                <th>Terbit</th>
                <th>Dhuha</th>
                <th>Dzuhur</th>
                <th>Ashar</th>
                <th>Maghrib</th>
                <th>Isya</th>
              </tr>
            </thead>
            <tbody id="scheduleContainer"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Audio: Tiga file MP3 -->
  <!-- Audio untuk adzan (non-subuh) -->
  <audio id="adhanAudio" src="audio_azan.mp3" preload="auto"></audio>
  <!-- Audio untuk adzan subuh -->
  <audio id="adhanSubuhAudio" src="audio_azan_subuh.mp3" preload="auto"></audio>
  <!-- Audio untuk imsak -->
  <audio id="imsakAudio" src="suara_imsak.mp3" preload="auto"></audio>

  <!-- Loading Indicator -->
  <div class="container mt-3">
    <div id="loadingIndicator" class="text-center" style="display: none;">
      <div class="spinner-border text-success" role="status"></div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script>
    // Fungsi helper untuk memastikan format waktu HH:mm
    function formatTime(timeStr) {
      const parts = timeStr.split(":");
      return parts.map(p => p.padStart(2, "0")).join(":");
    }

    let adzanPlayedFor = null;
    const countdownPrayerOrder = ["subuh", "dhuha", "dzuhur", "ashar", "maghrib", "isya"];
    let countdownInterval = null;
    const currentYear = new Date().getFullYear();

    const hariContainer = document.getElementById("hariContainer");
    const bulanContainer = document.getElementById("bulanContainer");
    const btnHari = document.getElementById("btnHari");
    const btnBulan = document.getElementById("btnBulan");
    const hariScheduleCard = document.getElementById("hariScheduleCard");
    const selectedInfo = document.getElementById("selectedInfo");

    // Event Tombol Segmented
    btnHari.addEventListener("click", function() {
      btnHari.classList.add("active");
      btnBulan.classList.remove("active");
      hariContainer.style.display = "block";
      bulanContainer.style.display = "none";
    });
    btnBulan.addEventListener("click", function() {
      btnBulan.classList.add("active");
      btnHari.classList.remove("active");
      hariContainer.style.display = "none";
      bulanContainer.style.display = "block";
      const currentMonthStr = (new Date().getMonth() + 1).toString().padStart(2, '0');
      fetchPrayerTimesForMonth(currentMonthStr);
    });

    // Fungsi Membuat Card Jadwal Hari
    function buildDailyCardHtml(schedule) {
      const dayNames = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
      const d = new Date();
      const dayName = dayNames[d.getDay()];
      const dateStr = d.getDate().toString().padStart(2, '0');
      const monthStr = (d.getMonth() + 1).toString().padStart(2, '0');
      const yearStr = d.getFullYear();
      const dateFullStr = `${dayName}, ${dateStr}/${monthStr}/${yearStr}`;
      return `
        <div class="card mx-auto" style="max-width: 500px;">
          <div class="card-header text-center bg-white">
            <h4 class="mb-1">Jadwal Sholat Hari Ini</h4>
            <small class="text-muted">${dateFullStr}</small>
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between">
              <span>Imsak</span><span>${formatTime(schedule.imsak)}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Subuh</span><span>${formatTime(schedule.subuh)}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Terbit</span><span>${formatTime(schedule.terbit)}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Dhuha</span><span>${formatTime(schedule.dhuha)}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Dzuhur</span><span>${formatTime(schedule.dzuhur)}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Ashar</span><span>${formatTime(schedule.ashar)}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Maghrib</span><span>${formatTime(schedule.maghrib)}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Isya</span><span>${formatTime(schedule.isya)}</span>
            </li>
          </ul>
        </div>
      `;
    }

    async function fetchPrayerTimesForMonth(month) {
      const cityId = $("#citySelect").val();
      if (cityId) {
        $("#loadingIndicator").show();
        try {
          const timestamp = new Date().getTime();
          const response = await fetch(`https://api.myquran.com/v2/sholat/jadwal/${cityId}/${currentYear}/${month}?t=${timestamp}`);
          const data = await response.json();
          if (data.status) {
            displaySchedule(data.data.jadwal);
          }
        } finally {
          $("#loadingIndicator").hide();
        }
      }
    }

    // Inisialisasi Select2
    $(document).ready(function() {
      $("#citySelect").select2({ placeholder: "Pilih Kota/Kab.", allowClear: true });
    });

    function selectCityByName(cityName) {
      let found = false;
      $("#citySelect option").each(function() {
        if ($(this).text().toLowerCase().includes(cityName.toLowerCase())) {
          $(this).prop("selected", true).trigger("change");
          found = true;
          return false;
        }
      });
      if (!found) {
        console.warn("Kota tidak ditemukan dalam daftar. Menggunakan pilihan default.");
      }
      handleSelectionChange();
    }

    async function loadCities() {
      const cacheKey = "cachedCities";
      const cachedData = localStorage.getItem(cacheKey);
      if (cachedData) {
        const data = JSON.parse(cachedData);
        populateCitySelect(data);
        return;
      }
      try {
        const response = await fetch("https://api.myquran.com/v2/sholat/kota/semua");
        const data = await response.json();
        localStorage.setItem(cacheKey, JSON.stringify(data.data));
        populateCitySelect(data.data);
      } catch (error) {
        console.error("Gagal mengambil data kota:", error);
      }
    }

    function populateCitySelect(data) {
      data.forEach(city => {
        $("#citySelect").append(`<option value="${city.id}">${city.lokasi}</option>`);
      });
    }

    async function handleSelectionChange() {
      const selectedMonth = (new Date().getMonth() + 1).toString().padStart(2, '0');
      const cityName = $("#citySelect option:selected").text();
      selectedInfo.textContent =
        `Jadwal Sholat dan Imsakiyah ${cityName} - Bulan ${getMonthName(selectedMonth)} ${currentYear}`;
      if (selectedMonth && $("#citySelect").val()) {
        await fetchPrayerTimesForMonth(selectedMonth);
      }
    }

    function getMonthName(month) {
      const monthNames = [
        "JANUARI", "FEBRUARI", "MARET", "APRIL", "MEI", "JUNI",
        "JULI", "AGUSTUS", "SEPTEMBER", "OKTOBER", "NOVEMBER", "DESEMBER"
      ];
      return monthNames[parseInt(month, 10) - 1] || month;
    }

    function displaySchedule(schedule) {
      const container = document.getElementById("scheduleContainer");
      container.innerHTML = "";
      const todayDate = new Date();
      const today = todayDate.getDate().toString().padStart(2, '0');
      let todaySchedule = null;
      let todayHighlightPrayer = -1;

      schedule.forEach(day => {
        const match = day.tanggal.match(/\d+/);
        const dayNumber = match ? parseInt(match[0]) : NaN;
        const isToday = (dayNumber.toString().padStart(2, '0') === today);
        let highlightPrayer = -1;
        if (isToday) {
          const now = new Date();
          const currentMinutes = now.getHours() * 60 + now.getMinutes();
          const subuhTime = parseInt(formatTime(day["subuh"]).split(":")[0], 10) * 60 + parseInt(formatTime(day["subuh"]).split(":")[1], 10);
          if (currentMinutes < subuhTime) {
            highlightPrayer = -2;
          } else {
            for (let i = 0; i < countdownPrayerOrder.length - 1; i++) {
              let parts1 = formatTime(day[countdownPrayerOrder[i]]).split(":");
              let parts2 = formatTime(day[countdownPrayerOrder[i + 1]]).split(":");
              let startMinutes = parseInt(parts1[0], 10) * 60 + parseInt(parts1[1], 10);
              let endMinutes = parseInt(parts2[0], 10) * 60 + parseInt(parts2[1], 10);
              if (currentMinutes >= startMinutes && currentMinutes < endMinutes) {
                highlightPrayer = i;
                break;
              }
            }
            let partsIsya = formatTime(day["isya"]).split(":");
            let isyaTime = parseInt(partsIsya[0], 10) * 60 + parseInt(partsIsya[1], 10);
            if (currentMinutes >= isyaTime) {
              highlightPrayer = countdownPrayerOrder.length - 1;
            }
          }
          todaySchedule = day;
          todayHighlightPrayer = highlightPrayer;
        }
        let rowHtml = `<tr class="${isToday ? 'highlight-today' : ''}">`;
        const keys = ["tanggal", "imsak", "subuh", "terbit", "dhuha", "dzuhur", "ashar", "maghrib", "isya"];
        keys.forEach((key) => {
          let extraClass = "";
          if (isToday && key !== "tanggal" && key !== "imsak" && key !== "terbit") {
            if (todayHighlightPrayer >= 0 && key === countdownPrayerOrder[todayHighlightPrayer]) {
              extraClass = "current-prayer";
            }
          }
          // Untuk kolom waktu, gunakan formatTime agar konsisten
          rowHtml += `<td class="${extraClass}">${key === "tanggal" ? day[key] : formatTime(day[key])}</td>`;
        });
        rowHtml += "</tr>";
        container.innerHTML += rowHtml;
      });
      if (todaySchedule) {
        hariScheduleCard.innerHTML = buildDailyCardHtml(todaySchedule);
        updateCountdownNotification(todaySchedule, todayHighlightPrayer);
        if (countdownInterval) clearInterval(countdownInterval);
        countdownInterval = setInterval(() => {
          updateCountdownNotification(todaySchedule, todayHighlightPrayer);
        }, 1000);
      } else {
        hariScheduleCard.innerHTML = `<p class="text-center mt-3">Tidak ada jadwal sholat untuk hari ini.</p>`;
      }
      scrollToToday();
    }

    function updateCountdownNotification(todaySchedule, highlightPrayer) {
      const notification = document.getElementById("prayerNotificationText");
      const now = new Date();
      const nowMinutes = now.getHours() * 60 + now.getMinutes();

      // Pastikan waktu imsak terformat
      const imsakTimeStr = formatTime(todaySchedule.imsak);
      const imsakParts = imsakTimeStr.split(":");
      const imsakMinutes = parseInt(imsakParts[0], 10) * 60 + parseInt(imsakParts[1], 10);
      if (nowMinutes < imsakMinutes) {
        const imsakDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), parseInt(imsakParts[0], 10), parseInt(imsakParts[1], 10), 0);
        let diffMs = imsakDate - now;
        if (diffMs < 0) diffMs = 0;
        const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
        const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
        const diffSeconds = Math.floor((diffMs % (1000 * 60)) / 1000);
        notification.innerHTML = `${diffHours} jam, ${diffMinutes} menit, ${diffSeconds} detik lagi menuju Imsak.`;
        if (diffHours === 0 && diffMinutes === 0 && diffSeconds === 0) {
          document.getElementById("imsakAudio").play();
        }
        return;
      }
      
      let notificationText = "";
      let nextPrayerIndex;
      if (highlightPrayer === -2) {
        nextPrayerIndex = 0;
      } else if (highlightPrayer >= 0 && highlightPrayer < countdownPrayerOrder.length - 1) {
        nextPrayerIndex = highlightPrayer + 1;
      } else if (highlightPrayer === countdownPrayerOrder.length - 1) {
        nextPrayerIndex = null;
      }
      
      if (nextPrayerIndex !== null) {
        const countdown = updateCountdown(todaySchedule, nextPrayerIndex);
        notificationText = `${countdown.diffHours} jam, ${countdown.diffMinutes} menit, ${countdown.diffSeconds} detik lagi memasuki sholat ${countdownPrayerOrder[nextPrayerIndex].toUpperCase()}.`;
        if (countdown.diffHours === 0 && countdown.diffMinutes === 0 && countdown.diffSeconds === 0) {
          if (adzanPlayedFor !== nextPrayerIndex) {
            if (nextPrayerIndex === 0) {
              document.getElementById("adhanSubuhAudio").play();
            } else {
              document.getElementById("adhanAudio").play();
            }
            adzanPlayedFor = nextPrayerIndex;
          }
        }
      } else {
        notificationText = "Sholat hari ini telah selesai.";
        adzanPlayedFor = null;
      }
      notification.innerHTML = notificationText;
    }

    function updateCountdown(todaySchedule, nextPrayerIndex) {
      const now = new Date();
      let timeStr = formatTime(todaySchedule[countdownPrayerOrder[nextPrayerIndex]]);
      const [hour, minute] = timeStr.split(":").map(Number);
      const nextPrayerDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hour, minute, 0);
      let diffMs = nextPrayerDate - now;
      if (diffMs < 0) diffMs = 0;
      const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
      const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
      const diffSeconds = Math.floor((diffMs % (1000 * 60)) / 1000);
      return { diffHours, diffMinutes, diffSeconds };
    }

    function scrollToToday() {
      const highlightRow = document.querySelector(".highlight-today");
      if (highlightRow) {
        highlightRow.scrollIntoView({
          behavior: "smooth",
          block: "start"
        });
      }
    }

    // Agar audio dapat diputar (Browser memerlukan interaksi pengguna)
    document.addEventListener("click", function enableAudio() {
      const adzanAudio = document.getElementById("adhanAudio");
      adzanAudio.play().then(() => {
        adzanAudio.pause();
        document.removeEventListener("click", enableAudio);
      }).catch((err) => {
        console.error("Audio play failed:", err);
      });
    });

    document.addEventListener("DOMContentLoaded", function () {
      function applyDarkMode() {
        let now = new Date();
        let hours = now.getHours();
        let isDarkMode = hours >= 18 || hours < 5;
        document.body.classList.toggle("dark-mode", isDarkMode);
      }
      applyDarkMode();
      setInterval(applyDarkMode, 1000);
    });

    $(document).ready(async function () {
      $("#citySelect").select2({ placeholder: "Pilih Kota/Kab.", allowClear: true });
      await loadCities();
      // Set default langsung ke kota Medan (ID "0228")
      $("#citySelect").val("0228").trigger("change");
      btnHari.classList.add("active");
      hariContainer.style.display = "block";
      bulanContainer.style.display = "none";
      const currentMonthStr = (new Date().getMonth() + 1).toString().padStart(2, '0');
      fetchPrayerTimesForMonth(currentMonthStr);
    });
  </script>
</body>
</html>
