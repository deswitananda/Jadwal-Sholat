<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="Description" content="Al-Qur'an Online Dengan Terjemahan Bahasa Indonesia (equran.id + Audio Alafasy)">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
    <!-- Google Font untuk teks Arab (Lateef) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lateef&display=swap">
    <!-- Animate.css untuk animasi -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <title>Al-Qur'an Digital</title>

    <style>
        /* Global Base */
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(45deg, #f0f4f8, #e0e7ff);
            color: #212529;
            font-family: 'Roboto', sans-serif;
            transition: background 0.5s ease, color 0.3s ease;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG {
            0% { background: linear-gradient(45deg, #f0f4f8, #e0e7ff); }
            25% { background: linear-gradient(45deg, #e0e7ff, #d1e3ff); }
            50% { background: linear-gradient(45deg, #d1e3ff, #e0e7ff); }
            75% { background: linear-gradient(45deg, #e0e7ff, #f0f4f8); }
            100% { background: linear-gradient(45deg, #f0f4f8, #e0e7ff); }
        }

        /* Navbar */
        .navbar {
            background: linear-gradient(45deg, #28a745, #1e7e34);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            animation: navbarPulse 5s ease infinite;
        }
        @keyframes navbarPulse {
            0% { box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
            50% { box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3); }
            100% { box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
        }
        .navbar-brand {
            font-size: 2rem;
            font-family: 'Lateef', serif;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            transition: transform 0.3s ease;
        }
        .navbar-brand:hover {
            transform: scale(1.1) rotate(2deg);
        }

        /* Spinner */
        .spinner {
            width: 80px;
            height: 80px;
            border: 10px solid #f3f3f3;
            border-top: 10px solid #28a745;
            border-radius: 50%;
            animation: spin 1s linear infinite, pulseSpinner 1.5s ease infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes pulseSpinner {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Card & Modal */
        .card, .modal-content {
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        .card:hover, .modal-content:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
        }
        .card-header, .modal-header {
            border-radius: 15px 15px 0 0;
            background: linear-gradient(45deg, #28a745, #34c759);
            color: #fff;
            animation: headerGradient 10s ease infinite;
        }
        @keyframes headerGradient {
            0% { background: linear-gradient(45deg, #28a745, #34c759); }
            50% { background: linear-gradient(45deg, #34c759, #28a745); }
            100% { background: linear-gradient(45deg, #28a745, #34c759); }
        }

        /* Surah List */
        .surah-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        .surah-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: none;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        .surah-card:hover {
            background: linear-gradient(135deg, #e9ecef, #f8f9fa);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.553);
        }
        .surah-card .arabic-name {
            font-family: 'Lateef', serif;
            direction: rtl;
            text-align: right;
            font-size: 1.8rem;
            color: #28a745;
            transition: color 0.3s ease;
        }
        .surah-card:hover .arabic-name {
            color: #1e7e34;
        }
        .surah-card .latin-name { font-size: 1.1rem; color: #212529; }
        .surah-card .translation { font-size: 0.95rem; color: #666; }
        .surah-card .verses { font-size: 0.95rem; color: #28a745; }
        .surah-card .favorite-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: transparent;
            border: none;
            font-size: 1.2rem;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        .surah-card .favorite-btn:hover {
            transform: scale(1.2);
            color: #ffc107;
        }

        /* Search Container */
        .search-container {
            position: relative;
            margin-bottom: 25px;
            animation: searchFadeIn 1s ease;
        }
        @keyframes searchFadeIn {
            0% { opacity: 0; transform: translateX(-20px); }
            100% { opacity: 1; transform: translateX(0); }
        }
        #surahSearch {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #28a745;
            border-radius: 25px;
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
        }
        #surahSearch:focus {
            border-color: #1e7e34;
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
            transform: scale(1.02);
            outline: none;
        }
        .voice-search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #28a745;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            color: #fff;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
        }
        .voice-search-btn:hover {
            background: #1e7e34;
            transform: translateY(-50%) rotate(360deg);
        }

        /* Voice Popup */
        .voice-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            text-align: center;
            pointer-events: none;
        }
        .voice-popup p {
            margin: 0;
            font-size: 1.2rem;
            color: #28a745;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 25px;
            align-items: center;
        }
        .pagination button {
            padding: 10px 15px;
            border: 2px solid #28a745;
            border-radius: 25px;
            background: #fff;
            color: #28a745;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .pagination button:hover {
            background: #28a745;
            color: #fff;
            transform: scale(1.1);
        }
        .pagination button:disabled {
            background: #e9ecef;
            border-color: #ccc;
            color: #666;
            cursor: not-allowed;
            transform: none;
        }
        .pagination .page-number {
            padding: 8px 16px;
            border: 2px solid #28a745;
            border-radius: 25px;
            background: #fff;
            color: #28a745;
            font-weight: 500;
            transition: background 0.3s ease, color 0.3s ease;
        }
        .pagination .page-number:hover {
            background: #28a745;
            color: #fff;
        }

        /* Audio Player */
        .audio-player {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #dcdcdc, #e9ecef);
            border-radius: 25px;
            padding: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: background 0.3s ease, transform 0.3s ease;
            animation: audioFadeIn 0.8s ease;
        }
        @keyframes audioFadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .audio-player:hover {
            background: linear-gradient(135deg, #28a745, #34c759);
            color: #fff;
            transform: scale(1.05);
        }
        .audio-player button {
            background: transparent;
            border: none;
            font-size: 1rem;
            margin: 0 10px;
            transition: color 0.3s ease, transform 0.3s ease;
        }
        .audio-player button:hover {
            color: #fff;
            transform: scale(1.2);
        }
        .audio-player input[type=range] {
            flex: 1;
            margin: 0 10px;
            accent-color: #28a745;
        }

        /* Dark Mode */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(45deg, #121212, #1e1e1e) !important;
                color: #e9ecef !important;
                animation: darkGradientBG 15s ease infinite;
            }
            @keyframes darkGradientBG {
                0% { background: linear-gradient(45deg, #121212, #1e1e1e); }
                25% { background: linear-gradient(45deg, #1e1e1e, #2d2d2d); }
                50% { background: linear-gradient(45deg, #2d2d2d, #1e1e1e); }
                75% { background: linear-gradient(45deg, #1e1e1e, #121212); }
                100% { background: linear-gradient(45deg, #121212, #1e1e1e); }
            }
            .navbar {
                background: linear-gradient(45deg, #1c7c54, #145f3f) !important;
            }
            .card, .modal-content {
                background: rgba(30, 30, 30, 0.977) !important;
                color: #e9ecef !important;
            }
            .card-header, .modal-header {
                background: linear-gradient(45deg, #1c7c54, #34c759) !important;
            }
            .surah-card {
                background: linear-gradient(135deg, #2d2d2d, #1e1e1e);
            }
            .surah-card:hover {
                background: linear-gradient(135deg, #1e1e1e, #2d2d2d);
            }
            .surah-card .arabic-name { color: #80ffa7; }
            .surah-card .latin-name { color: #e9ecef; }
            .surah-card .translation, .surah-card .verses { color: #b0b0b0; }
            .surah-card .favorite-btn { color: #fff; }
            .surah-card .favorite-btn:hover { color: #ffc107; }
            #surahSearch {
                background: #2d2d2d;
                border-color: #666;
                color: #e9ecef;
            }
            .voice-search-btn { background: #1c7c54; }
            .voice-search-btn:hover { background: #145f3f; }
            .pagination button { background: #2d2d2d; border-color: #666; color: #e9ecef; }
            .pagination button:hover { background: #1c7c54; color: #fff; }
            .pagination .page-number {
                background: #2d2d2d;
                border-color: #666;
                color: #e9ecef;
            }
            .pagination .page-number:hover {
                background: #1c7c54;
                color: #fff;
            }
            .audio-player { background: linear-gradient(135deg, #2d2d2d, #1e1e1e); }
            .audio-player:hover { background: linear-gradient(135deg, #1c7c54, #34c759); }
            .voice-popup { background: rgba(30, 30, 30, 0.95); color: #80ffa7; }
            
            /* Select2 Overrides */
    .select2-container--default .select2-selection--single {
      background-color: #1e1e1e !important;
      color: #e9ecef !important;
      border: 1px solid #666 !important;
    }
    .select2-container--default .select2-selection__rendered { color: #e9ecef !important; }
    .select2-container--default .select2-results__option--selectable {
      background-color: #1e1e1e !important;
      color: #e9ecef !important;
    }
    .select2-container--default .select2-results__option--highlighted[aria-selected] {
      background-color: #333 !important;
      color: #e9ecef !important;
    }
    .select2-container--default .select2-results__message {
      background-color: #1e1e1e !important;
      color: #e9ecef !important;
    }
    .select2-container--default .select2-search--dropdown .select2-search__field {
      background-color: #1e1e1e !important;
      color: #e9ecef !important;
    }
        }

        /* Responsive */
        @media (max-width: 767px) {
            .navbar-brand { font-size: 1.5rem; }
            .surah-list { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
            .surah-card .arabic-name { font-size: 1.5rem; }
            .voice-popup { width: 90%; }
        }

        /* Pastikan tidak ada backdrop yang mengganggu */
        .modal-backdrop {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="app" class="animate__animated animate__fadeIn">
        <!-- Navbar -->
        <nav class="navbar navbar-dark">
            <a class="navbar-brand animate__animated animate__pulse animate__infinite" href="#">Al-Qur'an Digital</a>
        </nav>

        <div class="container mt-4">
            <div v-if="lastRead" class="alert alert-info animate__animated animate__bounceIn" @click="goToLastRead">
                Terakhir Baca: Surat {{ lastRead.surahName }} - Ayat {{ lastRead.ayatNumber }}
                <button class="close" @click.stop="clearLastRead"><span>×</span></button>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <div class="card my-5 border-0 shadow animate__animated animate__zoomIn">
                        <div class="card-header my-card-header d-flex justify-content-between align-items-center">
                            <span class="animate__animated animate__fadeInLeft">Daftar Surah</span>
                            <div>
                                <button class="btn btn-outline-light btn-sm mr-2 animate__animated animate__rotateIn" @click="toggleShowFavorites">
                                    <i :class="{'fas fa-star text-warning': showFavorites, 'far fa-star': !showFavorites}"></i>
                                </button>
                                <button class="btn btn-outline-light btn-sm animate__animated animate__rotateIn" @click="refreshPage">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="search-container">
                                <input type="text" id="surahSearch" v-model="searchQuery" placeholder="Cari surah..." @input="filterSurahs">
                                <button class="voice-search-btn" @click="startVoiceSearch"><i class="fas fa-microphone"></i></button>
                            </div>
                            <div v-if="loading" class="d-flex justify-content-center">
                                <div class="spinner"></div>
                            </div>
                            <div v-else class="surah-list">
                                <div v-for="data in paginatedSurahs" :key="data.nomor" class="surah-card" @click="openDetailModal(data.nomor)">
                                    <button class="favorite-btn" @click.stop="toggleSurahBookmark(data)">
                                        <i :class="{'fas fa-star text-warning': isSurahBookmarked(data.nomor), 'far fa-star': !isSurahBookmarked(data.nomor)}"></i>
                                    </button>
                                    <div class="arabic-name">{{ data.nama }}</div>
                                    <div class="latin-name">{{ data.nama_latin }}</div>
                                    <div class="translation">{{ data.arti }}</div>
                                    <div class="verses">{{ data.jumlah_ayat }} Ayat</div>
                                </div>
                            </div>
                            <div class="pagination">
                                <button :disabled="currentPage === 1" @click="previousPage" class="animate__animated animate__fadeInLeft">Previous</button>
                                <span class="page-number">{{ currentPage }} / {{ totalPages }}</span>
                                <button :disabled="currentPage === totalPages" @click="nextPage" class="animate__animated animate__fadeInRight">Next</button>
                            </div>
                        </div>
                    </div>

                    <!-- Modal Detail Surah -->
                    <div class="modal fade" id="detailModal" tabindex="-1">
                        <div class="modal-dialog modal-xl">
                            <div class="modal-content my-modal-content animate__animated animate__zoomIn">
                                <div class="modal-header my-modal-header">
                                    <h5 style="font-size: 2rem;" class="animate__animated animate__fadeInDown">Surat <span :class="{'alfatihah-text': detail.nomor == 1}">{{ detail.asma }}</span></h5>
                                    <button type="button" class="close" data-dismiss="modal"><span>×</span></button>
                                </div>
                                <div class="modal-body">
                                    <div v-if="loading2" class="d-flex justify-content-center">
                                        <div class="spinner"></div>
                                    </div>
                                    <div v-else>
                                        <div class="row p-2">
                                            <div class="col-lg-6">
                                                <dl class="row animate__animated animate__fadeInLeft">
                                                    <dt class="col-sm-3">Nama</dt>
                                                    <dd class="col-sm-9">{{ detail.nama }}<br>{{ detail.asma }}</dd>
                                                    <dt class="col-sm-3">Arti</dt>
                                                    <dd class="col-sm-9">{{ detail.arti }}</dd>
                                                    <dt class="col-sm-3">Diturunkan di</dt>
                                                    <dd class="col-sm-9">{{ detail.type }}</dd>
                                                    <dt class="col-sm-3">Audio Surah</dt>
                                                    <dd class="col-sm-9">
                                                        <div class="audio-player" v-if="surahAudio">
                                                            <button @click="rewindSurahAudio"><i class="fas fa-backward"></i></button>
                                                            <button @click="toggleSurahAudio">
                                                                <i :class="{'fas fa-pause': surahAudioPlaying, 'fas fa-play': !surahAudioPlaying}"></i>
                                                            </button>
                                                            <input type="range" min="0" :max="surahAudioDuration" step="0.1" v-model="surahAudioCurrent" @input="seekSurahAudio">
                                                            <button @click="forwardSurahAudio"><i class="fas fa-forward"></i></button>
                                                            <span>{{ formatTime(surahAudioCurrent) }} / {{ formatTime(surahAudioDuration) }}</span>
                                                        </div>
                                                        <div v-else><em>Tidak ada audio surah</em></div>
                                                    </dd>
                                                    <dt class="col-sm-3">Keterangan</dt>
                                                    <dd class="col-sm-9 border border-secondary" style="max-height: 250px; overflow-y: scroll;">
                                                        <span v-html="detail.keterangan"></span>
                                                    </dd>
                                                </dl>
                                            </div>
                                            <div class="col-lg-6 animate__animated animate__fadeInRight">
                                                <h3 class="underline">Bacaan Surat {{ detail.asma }}</h3>
                                                <div v-if="detail.nomor !== 1" class="text-center mb-3" style="font-family: 'Lateef', serif; font-size: 2rem; color: #28a745;">
                                                    بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ
                                                </div>
                                                <div class="mb-3">
                                                    <select id="ayatSelect" style="width: 100%;"></select>
                                                </div>
                                                <div class="border border-success p-3" style="max-height: 450px; overflow-y: scroll; border-radius: 8px;">
                                                    <span v-for="(ayat, idx) in ayats" :key="ayat.nomor" :id="'ayat-' + ayat.nomor" class="animate__animated animate__fadeInUp">
                                                        <p><span class="badge badge-pill badge-success">Ayat {{ ayat.nomor }}</span></p>
                                                        <p class="arabic-text">{{ ayat.ar }}</p>
                                                        <p>
                                                            <small v-html="(ayat.tr && ayat.tr.trim()) ? ayat.tr : '(Transliterasi tidak tersedia)'"></small><br>
                                                            <small class="font-italic">{{ (ayat.id && ayat.id.trim()) ? ayat.id : '(Terjemahan tidak tersedia)' }}</small>
                                                        </p>
                                                        <div class="mt-2">
                                                            <button class="btn btn-sm btn-outline-secondary animate__animated animate__pulse animate__infinite" @click="copyAyat(idx+1, ayat)">
                                                                <i v-if="copiedAyats[ayat.nomor]" class="fas fa-check copied-check"></i>
                                                                <i v-else class="fas fa-copy"></i> Copy
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-primary ml-2" @click="togglePlay(ayat, idx)">
                                                                <i v-if="currentAudioIndex === idx && isPlaying" class="fas fa-stop"></i>
                                                                <i v-else class="fas fa-play"></i>
                                                                <span v-if="currentAudioIndex === idx && isPlaying"> Stop</span>
                                                                <span v-else> Play</span>
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-info ml-2" @click="toggleAyatBookmark(ayat)">
                                                                <i :class="{'fas fa-bookmark': isAyatBookmarked(detail.nomor, ayat.nomor), 'far fa-bookmark': !isAyatBookmarked(detail.nomor, ayat.nomor)}"></i>
                                                            </button>
                                                            <div class="btn-group ml-2">
                                                                <button class="btn btn-sm btn-success dropdown-toggle" data-toggle="dropdown">Share</button>
                                                                <div class="dropdown-menu">
                                                                    <a class="dropdown-item" href="#" @click.prevent="shareAyat('whatsapp', ayat)"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                                                                    <a class="dropdown-item" href="#" @click.prevent="shareAyat('facebook', ayat)"><i class="fab fa-facebook-f"></i> Facebook</a>
                                                                    <a class="dropdown-item" href="#" @click.prevent="shareAyat('instagram', ayat)"><i class="fab fa-instagram"></i> Instagram</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <hr>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-success animate__animated animate__fadeInLeft" @click="prevSurah" :disabled="!hasPrev"><i class="fas fa-arrow-left"></i></button>
                                    <button class="btn btn-success animate__animated animate__fadeInRight" @click="nextSurah" :disabled="!hasNext"><i class="fas fa-arrow-right"></i></button>
                                    <button class="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Voice Search Popup -->
        <div v-if="showVoicePopup" class="voice-popup" id="voicePopup">
            <p>{{ voiceText }}</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        var app = new Vue({
            el: '#app',
            data: {
                allSurahs: [],
                detail: {},
                ayats: [],
                loading: false,
                loading2: false,
                audioUrl: '',
                surahAudio: null,
                surahAudioPlaying: false,
                surahAudioCurrent: 0,
                surahAudioDuration: 0,
                currentAudio: null,
                currentAudioIndex: null,
                isPlaying: false,
                copiedAyats: {},
                lastRead: null,
                bookmarkedSurahs: {},
                showFavorites: false,
                searchQuery: '',
                currentPage: 1,
                itemsPerPage: 10,
                showVoicePopup: false,
                voiceText: ''
            },
            computed: {
                filteredSurahs() {
                    let filtered = this.allSurahs;
                    if (this.showFavorites) filtered = filtered.filter(s => this.isSurahBookmarked(s.nomor));
                    if (this.searchQuery) {
                        // Normalisasi query: hapus spasi dan tanda hubung, ubah ke huruf kecil
                        const query = this.searchQuery.toLowerCase().replace(/[\s-]/g, '');
                        filtered = filtered.filter(s => {
                            // Normalisasi nama surah dengan cara yang sama
                            const namaLatinNormalized = s.nama_latin.toLowerCase().replace(/[\s-]/g, '');
                            const namaNormalized = s.nama.toLowerCase().replace(/[\s-]/g, '');
                            const artiNormalized = s.arti.toLowerCase().replace(/[\s-]/g, '');
                            // Cek apakah query cocok dengan salah satu field yang dinormalisasi
                            return (
                                namaLatinNormalized.includes(query) ||
                                namaNormalized.includes(query) ||
                                artiNormalized.includes(query)
                            );
                        });
                    }
                    return filtered;
                },
                totalPages() { return Math.ceil(this.filteredSurahs.length / this.itemsPerPage); },
                paginatedSurahs() {
                    const start = (this.currentPage - 1) * this.itemsPerPage;
                    const end = start + this.itemsPerPage;
                    return this.filteredSurahs.slice(start, end);
                },
                currentIndex() { return this.filteredSurahs.findIndex(s => s.nomor == this.detail.nomor); },
                hasPrev() { return this.currentIndex > 0; },
                hasNext() { return this.currentIndex >= 0 && this.currentIndex < this.filteredSurahs.length - 1; }
            },
            methods: {
                refreshPage() { window.location.reload(); },
                padNumber(num, digits) { return num.toString().padStart(digits, '0'); },
                getDetail(nomorSurah) {
                    this.loading2 = true;
                    this.$http.get(`https://equran.id/api/surat/${nomorSurah}`).then(response => {
                        let res = response.body;
                        this.detail = {
                            nomor: res.nomor,
                            nama: res.nama,
                            asma: res.nama_latin,
                            arti: res.arti,
                            type: res.tempat_turun,
                            keterangan: res.deskripsi || ""
                        };
                        let rawAyats = res.ayat || [];
                        this.ayats = rawAyats.map(a => ({
                            nomor: a.nomor,
                            ar: a.ar,
                            tr: a.tr,
                            id: a.idn,
                            audio: `https://cdn.islamic.network/quran/audio/128/ar.alafasy/${this.padNumber(nomorSurah, 3)}${this.padNumber(a.nomor, 3)}.mp3`
                        }));
                        this.audioUrl = `https://cdn.islamic.network/quran/audio-surah/128/ar.alafasy/${nomorSurah}.mp3`;
                        this.initSurahAudio();
                        this.loading2 = false;
                        this.$nextTick(() => this.initSelect2());
                    }).catch(err => {
                        console.error('getDetail error', err);
                        this.loading2 = false;
                    });
                },
                openDetailModal(nomorSurah) {
                    this.getDetail(nomorSurah);
                    $('#detailModal').modal('show');
                },
                initSurahAudio() {
                    if (this.surahAudio) this.surahAudio.pause();
                    this.surahAudio = new Audio(this.audioUrl);
                    this.surahAudio.addEventListener('loadedmetadata', () => { this.surahAudioDuration = this.surahAudio.duration; });
                    this.surahAudio.addEventListener('timeupdate', () => { this.surahAudioCurrent = this.surahAudio.currentTime; });
                    this.surahAudio.addEventListener('ended', () => { this.surahAudioPlaying = false; });
                },
                toggleSurahAudio() {
                    if (!this.surahAudio) return;
                    if (this.surahAudioPlaying) {
                        this.surahAudio.pause();
                        this.surahAudioPlaying = false;
                    } else {
                        this.surahAudio.play();
                        this.surahAudioPlaying = true;
                    }
                },
                rewindSurahAudio() { if (this.surahAudio) this.surahAudio.currentTime = Math.max(0, this.surahAudio.currentTime - 5); },
                forwardSurahAudio() { if (this.surahAudio) this.surahAudio.currentTime = Math.min(this.surahAudioDuration, this.surahAudio.currentTime + 5); },
                seekSurahAudio(e) { if (this.surahAudio) this.surahAudio.currentTime = e.target.value; },
                formatTime(sec) {
                    let m = Math.floor(sec / 60);
                    let s = Math.floor(sec % 60);
                    return `${m}:${s < 10 ? '0' : ''}${s}`;
                },
                togglePlay(item, idx) {
                    if (this.currentAudio && this.currentAudioIndex === idx) {
                        if (this.isPlaying) {
                            this.currentAudio.pause();
                            this.isPlaying = false;
                        } else {
                            this.currentAudio.play();
                            this.isPlaying = true;
                        }
                    } else {
                        if (this.currentAudio) this.currentAudio.pause();
                        this.currentAudio = new Audio(item.audio);
                        this.currentAudioIndex = idx;
                        this.isPlaying = true;
                        this.currentAudio.onended = () => {
                            let nextIdx = idx + 1;
                            if (nextIdx < this.ayats.length) this.togglePlay(this.ayats[nextIdx], nextIdx);
                            else { this.isPlaying = false; this.currentAudio = null; this.currentAudioIndex = null; }
                        };
                        this.currentAudio.play();
                        let t = document.getElementById(`ayat-${idx+1}`);
                        if (t) t.scrollIntoView({ behavior: "smooth", block: "start" });
                    }
                },
                copyAyat(idx, item) {
                    let text = `Ayat ${idx}\nArab: ${item.ar}\nLatin: ${item.tr}\nTerjemahan: ${item.id}`;
                    navigator.clipboard.writeText(text).then(() => {
                        this.$set(this.copiedAyats, item.nomor, true);
                        setTimeout(() => this.$delete(this.copiedAyats, item.nomor), 1000);
                    });
                },
                shareAyat(platform, item) {
                    let text = `${item.ar}\n\n${item.id}\n\n(Dibagikan dari Al-Qur'an Digital)`;
                    if (platform === 'whatsapp') window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
                    else if (platform === 'facebook') window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://example.com')}&quote=${encodeURIComponent(text)}`, '_blank');
                    else if (platform === 'instagram') window.open('https://instagram.com/', '_blank');
                },
                initSelect2() {
                    $('#ayatSelect').select2({
                        placeholder: 'Pilih ayat...',
                        allowClear: true,
                        data: this.ayats.map(a => ({ id: a.nomor, text: `Ayat ${a.nomor}: ${a.ar.substring(0, 20)}...` }))
                    });
                    $('#ayatSelect').on('change', () => {
                        let val = $('#ayatSelect').val();
                        if (val) document.getElementById(`ayat-${val}`).scrollIntoView({ behavior: "smooth", block: "start" });
                    });
                },
                isAyatBookmarked(surahNumber, ayatNumber) {
                    return this.lastRead && this.lastRead.surahNumber === surahNumber && this.lastRead.ayatNumber === ayatNumber;
                },
                toggleAyatBookmark(ayat) {
                    this.lastRead = this.isAyatBookmarked(this.detail.nomor, ayat.nomor) ? null : {
                        surahNumber: this.detail.nomor,
                        surahName: this.detail.asma,
                        ayatNumber: ayat.nomor,
                        ar: ayat.ar,
                        tr: ayat.tr,
                        id: ayat.id
                    };
                },
                goToLastRead() {
                    if (this.lastRead) {
                        this.getDetail(this.lastRead.surahNumber);
                        $('#detailModal').modal('show');
                        this.$nextTick(() => {
                            setTimeout(() => document.getElementById(`ayat-${this.lastRead.ayatNumber}`).scrollIntoView({ behavior: "smooth", block: "start" }), 500);
                        });
                    }
                },
                clearLastRead() { this.lastRead = null; },
                isSurahBookmarked(surahNumber) { return !!this.bookmarkedSurahs[surahNumber]; },
                toggleSurahBookmark(surah) {
                    if (this.isSurahBookmarked(surah.nomor)) this.$delete(this.bookmarkedSurahs, surah.nomor);
                    else this.$set(this.bookmarkedSurahs, surah.nomor, surah);
                },
                filterSurahs() { this.currentPage = 1; },
                previousPage() { if (this.currentPage > 1) this.currentPage--; },
                nextPage() { if (this.currentPage < this.totalPages) this.currentPage++; },
                prevSurah() { if (this.hasPrev) this.getDetail(this.filteredSurahs[this.currentIndex - 1].nomor); },
                nextSurah() { if (this.hasNext) this.getDetail(this.filteredSurahs[this.currentIndex + 1].nomor); },
                toggleShowFavorites() { this.showFavorites = !this.showFavorites; this.currentPage = 1; },
                startVoiceSearch() {
                    if (!('webkitSpeechRecognition' in window)) {
                        alert('Browser Anda tidak mendukung fitur pencarian suara.');
                        return;
                    }
                    const recognition = new webkitSpeechRecognition();
                    recognition.lang = 'id-ID';
                    recognition.continuous = false;
                    recognition.interimResults = true;

                    this.showVoicePopup = true;
                    this.voiceText = 'Mendengarkan...';
                    document.body.classList.remove('modal-open');
                    if (document.querySelector('.modal-backdrop')) {
                        document.querySelector('.modal-backdrop').remove();
                    }

                    recognition.onresult = (event) => {
                        const interimTranscript = Array.from(event.results)
                            .map(result => result[0].transcript)
                            .join('');
                        this.voiceText = interimTranscript || 'Mendengarkan...';
                        if (event.results[0].isFinal) {
                            this.searchQuery = event.results[0][0].transcript;
                            this.filterSurahs();
                            setTimeout(() => {
                                this.showVoicePopup = false;
                                document.body.classList.remove('modal-open');
                                if (document.querySelector('.modal-backdrop')) {
                                    document.querySelector('.modal-backdrop').remove();
                                }
                            }, 1000);
                        }
                    };
                    recognition.onend = () => {
                        if (this.voiceText === 'Mendengarkan...') {
                            this.voiceText = 'Tidak ada suara terdeteksi';
                            setTimeout(() => {
                                this.showVoicePopup = false;
                                document.body.classList.remove('modal-open');
                                if (document.querySelector('.modal-backdrop')) {
                                    document.querySelector('.modal-backdrop').remove();
                                }
                            }, 1000);
                        }
                    };
                    recognition.onerror = (event) => {
                        this.voiceText = 'Error: ' + event.error;
                        setTimeout(() => {
                            this.showVoicePopup = false;
                            document.body.classList.remove('modal-open');
                            if (document.querySelector('.modal-backdrop')) {
                                document.querySelector('.modal-backdrop').remove();
                            }
                        }, 1000);
                        console.error('Voice recognition error:', event.error);
                    };
                    recognition.start();
                }
            },
            mounted() {
                this.loading = true;
                this.$http.get('https://equran.id/api/surat').then(res => {
                    this.allSurahs = res.body;
                    this.loading = false;
                }).catch(err => {
                    console.error('error', err);
                    this.loading = false;
                });

                $('#detailModal').on('hidden.bs.modal', () => {
                    if (this.surahAudio) this.surahAudio.pause();
                    if (this.currentAudio) this.currentAudio.pause();
                    this.surahAudioPlaying = false;
                    this.isPlaying = false;
                    this.currentAudio = null;
                    this.currentAudioIndex = null;
                });
            }
        });
    </script>
</body>
</html>