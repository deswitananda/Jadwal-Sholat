<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Baca Al-Qur'an - Bookmark Bintang & Tabel Bookmark</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Playfair+Display&display=swap" rel="stylesheet">
  <style>
    /* Variabel warna Light Mode */
    :root {
      --primary-color: #2C6E49;
      --accent-color: #FFD700; /* Warna emas untuk bintang aktif */
      --faded-color: #ccc;     /* Warna bintang pudar */
      --bg-color: #F5F5F5;
      --card-bg: #FFFFFF;
      --text-color: #333333;
      --shadow: 0 2px 4px rgba(0,0,0,0.1);
      --transition-speed: 0.3s;
      --border-radius: 10px;
    }
    /* Dark Mode */
    @media (prefers-color-scheme: dark) {
      :root {
         --primary-color: #A9D18E;
         --accent-color: #FFD700;
         --faded-color: #888;
         --bg-color: #121212;
         --card-bg: #1E1E1E;
         --text-color: #E0E0E0;
         --shadow: 0 2px 4px rgba(0,0,0,0.5);
      }
    }
    /* Global Styles */
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Montserrat', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.8;
    }
    .container {
      width: 95%;
      max-width: 1100px;
      background: var(--card-bg);
      padding: 30px 40px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      margin: 0 auto;
      animation: fadeIn var(--transition-speed) ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    h1 {
      font-family: 'Playfair Display', serif;
      text-align: center;
      font-size: 38px;
      color: var(--primary-color);
      margin-bottom: 30px;
    }
    .main-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .main-buttons button {
      background: var(--primary-color);
      color: var(--card-bg);
      border: none;
      padding: 12px 28px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 16px;
      transition: background var(--transition-speed), transform var(--transition-speed);
    }
    .main-buttons button:hover {
      background: var(--accent-color);
      transform: translateY(-2px);
    }
    .search-container {
      text-align: center;
      position: relative;
      margin-bottom: 35px;
    }
    .search-container input {
      width: 100%;
      max-width: 420px;
      padding: 14px 22px;
      font-size: 18px;
      border: 1px solid #ccc;
      border-radius: 50px;
      outline: none;
      transition: border-color 0.3s;
      background: var(--bg-color);
      color: var(--text-color);
    }
    .search-container input::placeholder {
      color: #777;
    }
    .search-container input:focus {
      border-color: var(--primary-color);
    }
    .suggestions {
      width: 100%;
      max-width: 420px;
      background: var(--card-bg);
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      box-shadow: var(--shadow);
      margin: 0 auto;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      top: 60px;
      z-index: 10;
      overflow: hidden;
    }
    .suggestions div {
      padding: 12px 18px;
      cursor: pointer;
      border-bottom: 1px solid #ddd;
      transition: background var(--transition-speed);
      color: var(--text-color);
    }
    .suggestions div:last-child {
      border-bottom: none;
    }
    .suggestions div:hover {
      background: var(--accent-color);
      color: var(--card-bg);
    }
    /* Tabel Bookmark */
    #bookmarkContainer {
      margin: 20px 0;
    }
    #bookmarkContainer h2 {
      font-size: 24px;
      margin-bottom: 10px;
      color: var(--primary-color);
    }
    #bookmarkTable {
      width: 100%;
      border-collapse: collapse;
    }
    #bookmarkTable th, #bookmarkTable td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    #bookmarkTable th {
      background: var(--bg-color);
    }
    /* Tampilan grid untuk menu surah */
    #surahMenu {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .surah-card {
      background: var(--card-bg);
      border: 1px solid #eee;
      border-radius: var(--border-radius);
      padding: 20px;
      text-align: center;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: transform var(--transition-speed), box-shadow var(--transition-speed);
      position: relative;
    }
    .surah-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }
    .surah-card h3 {
      margin: 10px 0;
      font-size: 24px;
      color: var(--primary-color);
    }
    .surah-card p {
      margin: 5px 0;
      font-size: 16px;
    }
    /* Tombol Bookmark (ikon bintang) */
    .bookmark-btn {
      background: transparent;
      border: none;
      font-size: 22px;
      cursor: pointer;
      transition: color 0.3s;
    }
    .bookmark-btn:not(.bookmarked) {
      color: var(--faded-color);
    }
    .bookmark-btn.bookmarked {
      color: var(--accent-color);
    }
    /* Modal Pop-up untuk Detail Surah */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 10px;
    }
    .modal-content {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      width: 100%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
      animation: fadeIn var(--transition-speed) ease-in-out;
    }
    .close-modal {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--primary-color);
      color: var(--card-bg);
      border: none;
      border-radius: 50%;
      padding: 10px 14px;
      cursor: pointer;
      font-size: 18px;
      transition: background var(--transition-speed), transform var(--transition-speed);
    }
    .close-modal:hover {
      background: var(--accent-color);
      transform: scale(1.1);
    }
    /* Tombol aksi: copy, share, audio */
    .copy-btn, .share-btn, .audio-player button {
      background: var(--primary-color);
      color: var(--card-bg);
      border: none;
      border-radius: 8px;
      padding: 8px 14px;
      cursor: pointer;
      font-size: 14px;
      transition: background var(--transition-speed), transform var(--transition-speed);
      margin-top: 10px;
    }
    .copy-btn:hover, .share-btn:hover, .audio-player button:hover {
      background: var(--accent-color);
      transform: translateY(-2px);
    }
    .share-options {
      background: var(--card-bg);
      border: 1px solid var(--primary-color);
      border-radius: 8px;
      padding: 5px;
      margin-top: 5px;
      box-shadow: var(--shadow);
      display: none;
      position: absolute;
      z-index: 100;
      width: 150px;
    }
    .share-option {
      background: transparent;
      color: var(--primary-color);
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background var(--transition-speed);
      margin: 2px 0;
      text-align: left;
      width: 100%;
    }
    .share-option:hover {
      background: var(--accent-color);
      color: var(--card-bg);
    }
    /* Audio Player Custom */
    .audio-player {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    /* Responsive */
    @media (max-width: 600px) {
      body { padding: 10px; }
      .container { padding: 20px; }
      h1 { font-size: 32px; }
      .main-buttons button { padding: 10px 20px; font-size: 14px; }
      .search-container input { font-size: 16px; padding: 12px 18px; }
      .surah-card h3 { font-size: 20px; }
    }
    @media (min-width: 601px) and (max-width: 992px) {
      .container { padding: 25px 30px; }
      h1 { font-size: 34px; }
      .main-buttons button { padding: 11px 22px; font-size: 15px; }
      .search-container input { font-size: 17px; padding: 13px 20px; }
      .surah-card h3 { font-size: 22px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Baca Al-Qur'an</h1>
    <div class="main-buttons">
      <button id="surahBtn" onclick="showSurahUI()">Surah</button>
      <button id="muratalBtn" onclick="window.location.href='muratal.html'">Muratal</button>
    </div>
    
    <!-- Tabel Bookmark yang selalu muncul -->
    <div id="bookmarkContainer">
      <h2>Bookmark Tersimpan</h2>
      <table id="bookmarkTable">
        <thead>
          <tr>
            <th>Tipe</th>
            <th>Surah</th>
            <th>Ayat</th>
          </tr>
        </thead>
        <tbody>
          <!-- Baris bookmark akan dimuat secara dinamis -->
        </tbody>
      </table>
    </div>
    
    <div class="search-container">
      <input type="text" id="surahSearch" placeholder="Cari surah (nama atau nomor)..." autocomplete="off">
      <div class="suggestions" id="suggestions"></div>
    </div>
    <div id="surahMenu"></div>
  </div>
  
  <!-- Modal untuk Detail Surah -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-content">
      <button class="close-modal" id="closeModal">X</button>
      <!-- Dropdown navigasi ayat -->
      <select id="ayahDropdown" style="margin-bottom: 10px;"></select>
      <div id="modalSurahDetail">
        <!-- Detail surah akan muncul di sini -->
      </div>
    </div>
  </div>
  
  <script>
    /* --- FUNGSI BOOKMARK --- */
    function getBookmarks() {
      const bookmarks = localStorage.getItem('bookmarks');
      return bookmarks ? JSON.parse(bookmarks) : {};
    }
    function setBookmarks(bookmarks) {
      localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
    }
    function isBookmarked(key) {
      const bookmarks = getBookmarks();
      return !!bookmarks[key];
    }
    function toggleBookmark(key) {
      const bookmarks = getBookmarks();
      if (bookmarks[key]) {
        delete bookmarks[key];
      } else {
        bookmarks[key] = true;
      }
      setBookmarks(bookmarks);
    }
    // Update tampilan tombol bookmark: jika bookmarked tampilkan ★, jika tidak ☆
    function updateBookmarkUI() {
      document.querySelectorAll('.bookmark-btn').forEach(btn => {
        let key = '';
        if (btn.classList.contains('surah-bookmark')) {
          const surah = btn.getAttribute('data-surah');
          key = 'surah-' + surah;
        } else if (btn.classList.contains('ayah-bookmark')) {
          const surah = btn.getAttribute('data-surah');
          const ayah = btn.getAttribute('data-ayah');
          key = 'surah-' + surah + '-ayah-' + ayah;
        }
        if (isBookmarked(key)) {
          btn.classList.add('bookmarked');
          btn.innerText = '★';
        } else {
          btn.classList.remove('bookmarked');
          btn.innerText = '☆';
        }
      });
      updateBookmarkTable();
    }
    
    /* --- FUNGSI UNTUK MEMUNCULKAN TABEL BOOKMARK --- */
    function updateBookmarkTable() {
      const bookmarks = getBookmarks();
      const tbody = document.querySelector('#bookmarkTable tbody');
      tbody.innerHTML = ''; // Kosongkan tabel sebelum dimuat ulang
      for (const key in bookmarks) {
        if (bookmarks.hasOwnProperty(key)) {
          let type = '';
          let surahNum = '';
          let ayatNum = '';
          const matchSurah = key.match(/^surah-(\d+)$/);
          const matchAyat = key.match(/^surah-(\d+)-ayah-(\d+)$/);
          if (matchSurah) {
            type = 'Surah';
            surahNum = matchSurah[1];
            ayatNum = '-';
          } else if (matchAyat) {
            type = 'Ayat';
            surahNum = matchAyat[1];
            ayatNum = matchAyat[2];
          }
          const surahName = surahNamesID[surahNum] || '';
          const tr = document.createElement('tr');
          tr.style.cursor = 'pointer';
          tr.innerHTML = `
            <td>${type}</td>
            <td>${surahNum}. ${surahName}</td>
            <td>${ayatNum}</td>
          `;
          tr.addEventListener('click', function() {
            jumpToBookmark(key);
          });
          tbody.appendChild(tr);
        }
      }
    }
    
    /* --- FUNGSI UNTUK MENUJU KE BOOKMARK --- */
    function jumpToBookmark(key) {
      const matchSurah = key.match(/^surah-(\d+)$/);
      const matchAyat = key.match(/^surah-(\d+)-ayah-(\d+)$/);
      if (matchSurah) {
        loadSurah(matchSurah[1]);
      } else if (matchAyat) {
        loadSurah(matchAyat[1]);
        // Setelah detail surah dimuat, scroll ke ayat terkait
        setTimeout(() => {
          const ayahEl = document.getElementById(`ayah-${parseInt(matchAyat[2]) - 1}`);
          if (ayahEl) {
            ayahEl.scrollIntoView({ behavior: 'smooth' });
          }
        }, 1000);
      }
    }
    
    /* --- FUNGSI UTAMA UI --- */
    function showSurahUI() {
      document.getElementById('surahMenu').style.display = 'grid';
    }
    document.getElementById('closeModal').addEventListener('click', function() {
      document.getElementById('modalOverlay').style.display = 'none';
    });
    
    let surahList = [];
    const surahNamesID = [
      "",
      "Al-Fatihah",
      "Al-Baqarah",
      "Ali Imran",
      "An-Nisa",
      "Al-Ma'idah",
      "Al-An'am",
      "Al-A'raf",
      "Al-Anfal",
      "At-Taubah",
      "Yunus",
      "Hud",
      "Yusuf",
      "Ar-Ra'd",
      "Ibrahim",
      "Al-Hijr",
      "An-Nahl",
      "Al-Isra",
      "Al-Kahf",
      "Maryam",
      "Ta-Ha",
      "Al-Anbiya",
      "Al-Hajj",
      "Al-Mu'minun",
      "An-Nur",
      "Al-Furqan",
      "Asy-Syura",
      "An-Naml",
      "Al-Qasas",
      "Al-Ankabut",
      "Ar-Rum",
      "Luqman",
      "As-Sajdah",
      "Al-Ahzab",
      "Saba",
      "Fatir",
      "Ya Sin",
      "As-Saffat",
      "Sad",
      "Az-Zumar",
      "Ghafir",
      "Fussilat",
      "Ash-Shura",
      "Az-Zukhruf",
      "Ad-Dukhan",
      "Al-Jathiyah",
      "Al-Ahqaf",
      "Muhammad",
      "Al-Fath",
      "Al-Hujurat",
      "Qaf",
      "Adz-Dzariyat",
      "At-Tur",
      "An-Najm",
      "Al-Qamar",
      "Ar-Rahman",
      "Al-Waqi'ah",
      "Al-Hadid",
      "Al-Mujadilah",
      "Al-Hashr",
      "Al-Mumtahanah",
      "As-Saf",
      "Al-Jumu'ah",
      "Al-Munafiqun",
      "At-Taghabun",
      "At-Talaq",
      "At-Tahrim",
      "Al-Mulk",
      "Al-Qalam",
      "Al-Haqqah",
      "Al-Ma'arij",
      "Nuh",
      "Al-Jinn",
      "Al-Muzzammil",
      "Al-Muddaththir",
      "Al-Qiyamah",
      "Al-Insan",
      "Al-Mursalat",
      "An-Naba",
      "An-Nazi'at",
      "Abasa",
      "At-Takwir",
      "Al-Infitar",
      "Al-Mutaffifin",
      "Al-Insyiqaq",
      "Al-Buruj",
      "At-Tariq",
      "Al-A'la",
      "Al-Ghasyiyah",
      "Al-Fajr",
      "Al-Balad",
      "Asy-Syams",
      "Al-Lail",
      "Ad-Dhuha",
      "Al-Insyirah",
      "At-Tin",
      "Al-'Alaq",
      "Al-Qadr",
      "Al-Bayyinah",
      "Az-Zalzalah",
      "Al-'Adiyat",
      "Al-Qari'ah",
      "At-Takatsur",
      "Al-'Asr",
      "Al-Humazah",
      "Al-Fil",
      "Quraysh",
      "Al-Ma'un",
      "Al-Kausar",
      "Al-Kafirun",
      "An-Nasr",
      "Al-Lahab",
      "Al-Ikhlas",
      "Al-Falaq",
      "An-Nas"
    ];
    
    // Tampilkan daftar surah dalam menu (dengan tombol bookmark berupa bintang)
    function populateSurahMenu(list) {
      const menu = document.getElementById('surahMenu');
      menu.style.display = 'grid';
      menu.innerHTML = "";
      list.forEach(surah => {
        const card = document.createElement('div');
        card.className = 'surah-card';
        card.innerHTML = `
          <h3>${surah.number}</h3>
          <p>${surahNamesID[surah.number]}</p>
          <p>(${surah.name})</p>
          <button class="bookmark-btn surah-bookmark" data-surah="${surah.number}" title="Tandai Surah">☆</button>
        `;
        // Klik pada kartu (kecuali tombol bookmark) membuka detail surah
        card.addEventListener('click', (e) => {
          if(e.target.classList.contains('bookmark-btn')) return;
          loadSurah(surah.number);
        });
        // Event untuk tombol bookmark di kartu
        card.querySelector('.bookmark-btn').addEventListener('click', function(e) {
          e.stopPropagation();
          const surahNum = this.getAttribute('data-surah');
          toggleBookmark('surah-' + surahNum);
          updateBookmarkUI();
        });
        menu.appendChild(card);
      });
      updateBookmarkUI();
    }
    
    function updateSuggestions() {
      const query = document.getElementById('surahSearch').value.toLowerCase();
      const cleanedQuery = query.replace(/-/g, '');
      const suggestionDiv = document.getElementById('suggestions');
      suggestionDiv.innerHTML = '';
      if (!cleanedQuery) return;
      const filtered = surahList.filter(surah => {
        const indoName = surahNamesID[surah.number].toLowerCase().replace(/-/g, '');
        const arabicName = surah.name.toLowerCase();
        return indoName.includes(cleanedQuery) || arabicName.includes(cleanedQuery) || String(surah.number).includes(cleanedQuery);
      });
      filtered.forEach(surah => {
        const div = document.createElement('div');
        div.textContent = `${surahNamesID[surah.number]} (${surah.name})`;
        div.addEventListener('click', () => {
          document.getElementById('surahSearch').value = div.textContent;
          suggestionDiv.innerHTML = '';
          loadSurah(surah.number);
        });
        suggestionDiv.appendChild(div);
      });
    }
    document.getElementById('surahSearch').addEventListener('input', updateSuggestions);
    
    function copyText(text) {
      navigator.clipboard.writeText(text).then(() => {
        alert('Teks berhasil disalin!');
      }).catch(err => {
        alert('Gagal menyalin teks.');
      });
    }
    
    function loadSurah(surahNumber) {
      const modalOverlay = document.getElementById('modalOverlay');
      const modalSurahDetail = document.getElementById('modalSurahDetail');
      modalOverlay.style.display = 'flex';
      modalSurahDetail.innerHTML = '<p>Memuat detail surah...</p>';
      
      fetch(`https://quran-api.santrikoding.com/api/surah/${surahNumber}`)
        .then(response => response.json())
        .then(data => {
          renderSurahDetail(data);
          loadTranslation(surahNumber);
        })
        .catch(error => {
          console.error('Error mengambil detail surah:', error);
          modalSurahDetail.innerHTML = '<p>Gagal memuat detail surah.</p>';
        });
    }
    
    function renderSurahDetail(data) {
      // Header surah dengan tombol bookmark untuk surah
      let html = `
      <div style="display: flex; align-items: center; justify-content: space-between;">
        <h2>${data.nama} (${data.nomor})</h2>
        <button class="bookmark-btn surah-bookmark" data-surah="${data.nomor}" title="Tandai Surah">☆</button>
      </div>
      `;
      if (parseInt(data.nomor) !== 1 && parseInt(data.nomor) !== 9) {
        html += `<div class="bismillah" style="font-size:20px; margin:15px 0;">بِسْمِ اللَّهِ الرَّحْمَـٰنِ الرَّحِيمِ</div>`;
      }
      // Reset dropdown navigasi ayat
      document.getElementById('ayahDropdown').innerHTML = '<option value="">Pilih Ayat</option>';
      data.ayat.forEach((ayat, index) => {
        const nomorAyat = ayat.nomor || (index + 1);
        const option = document.createElement('option');
        option.value = index;
        option.textContent = `Ayat ke-${nomorAyat}`;
        document.getElementById('ayahDropdown').appendChild(option);
        html += `
          <div class="ayah-container" id="ayah-${index}" style="margin-bottom:25px;">
            <div class="ayah-number" style="font-weight:600; margin-bottom:8px;">Ayat ke-${nomorAyat}</div>
            <p class="arabic" style="font-size:24px; text-align:right; margin-bottom:10px;">${ayat.ar}</p>
            <p class="latin" style="font-size:18px; margin-bottom:10px;">${ayat.tr || ''}</p>
            ${ayat.audio ? `<audio controls src="${ayat.audio}" style="display:none;"></audio>` : ''}
            <p class="translation" id="translation-${index}" style="font-size:16px;">Memuat terjemahan...</p>
            <div class="controls" style="text-align:center;">
              <button class="copy-btn" data-arabic="${ayat.ar}" data-latin="${ayat.tr || ''}" data-translation="">Copy Ayat</button>
              <div class="share-dropdown" style="position: relative; display: inline-block;">
                <button class="share-btn">Share</button>
                <div class="share-options">
                  <button class="share-option" data-platform="wa" data-text="${ayat.ar} | ${ayat.tr || ''}">WhatsApp</button>
                  <button class="share-option" data-platform="fb" data-text="${ayat.ar} | ${ayat.tr || ''}">Facebook</button>
                  <button class="share-option" data-platform="tw" data-text="${ayat.ar} | ${ayat.tr || ''}">Twitter</button>
                  <button class="share-option" data-platform="email" data-text="${ayat.ar} | ${ayat.tr || ''}">Email</button>
                  <button class="share-option" data-platform="others" data-text="${ayat.ar} | ${ayat.tr || ''}">Lainnya</button>
                </div>
              </div>
              <button class="bookmark-btn ayah-bookmark" data-surah="${data.nomor}" data-ayah="${nomorAyat}" title="Tandai Ayat">☆</button>
            </div>
          </div>
        `;
      });
      document.getElementById('modalSurahDetail').innerHTML = html;
      
      // Navigasi ayat melalui dropdown
      document.getElementById('ayahDropdown').addEventListener('change', function () {
        const idx = this.value;
        if (idx !== '') {
          const ayahEl = document.getElementById(`ayah-${idx}`);
          if (ayahEl) {
            ayahEl.scrollIntoView({ behavior: 'smooth' });
          }
        }
      });
      
      // Fitur Copy
      document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', function () {
          const arabic = this.getAttribute('data-arabic');
          const latin = this.getAttribute('data-latin');
          const translation = this.getAttribute('data-translation');
          const text = `${arabic}\n${latin}\n${translation}`;
          copyText(text);
        });
      });
      
      // Share dropdown
      document.querySelectorAll('.share-btn').forEach(btn => {
        btn.addEventListener('click', function (event) {
          event.stopPropagation();
          const shareOptions = this.nextElementSibling;
          if (shareOptions.style.display === 'block') {
            shareOptions.style.display = 'none';
          } else {
            document.querySelectorAll('.share-options').forEach(opt => opt.style.display = 'none');
            shareOptions.style.display = 'block';
          }
        });
      });
      document.querySelectorAll('.share-option').forEach(btn => {
        btn.addEventListener('click', function (event) {
          event.stopPropagation();
          const platform = this.getAttribute('data-platform');
          const text = this.getAttribute('data-text');
          if (platform === 'wa') {
            const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
          } else if (platform === 'fb') {
            const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(text)}`;
            window.open(shareUrl, '_blank');
          } else if (platform === 'tw') {
            const shareUrl = `https://twitter.com/intend/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(window.location.href)}`;
            window.open(shareUrl, '_blank');
          } else if (platform === 'email') {
            window.location.href = `mailto:?subject=Ayat Quran&body=${encodeURIComponent(text + '\n' + window.location.href)}`;
          } else if (platform === 'others') {
            if (navigator.share) {
              navigator.share({
                title: 'Baca Al-Quran',
                text: text,
                url: window.location.href
              }).catch(error => console.error('Error sharing:', error));
            } else {
              alert('Fitur share tidak didukung di browser Anda.');
            }
          }
          this.parentElement.style.display = 'none';
        });
      });
      
      // Event untuk tombol bookmark di modal (baik surah maupun ayat)
      document.querySelectorAll('.bookmark-btn').forEach(btn => {
        btn.addEventListener('click', function (event) {
          event.stopPropagation();
          let key = '';
          if (btn.classList.contains('surah-bookmark')) {
            const surah = btn.getAttribute('data-surah');
            key = 'surah-' + surah;
          } else if (btn.classList.contains('ayah-bookmark')) {
            const surah = btn.getAttribute('data-surah');
            const ayah = btn.getAttribute('data-ayah');
            key = 'surah-' + surah + '-ayah-' + ayah;
          }
          toggleBookmark(key);
          updateBookmarkUI();
        });
      });
      updateBookmarkUI();
    }
    
    function loadTranslation(nomor) {
      fetch(`https://api.alquran.cloud/v1/surah/${nomor}/editions/quran-uthmani,id.indonesian,ar.alafasy,en.transliteration`)
        .then(response => response.json())
        .then(data => {
          const indoData = data.data[1];
          const audioData = data.data[2];
          const transliterationData = data.data[3];
          // Update terjemahan
          indoData.ayahs.forEach((ayah, index) => {
            const translationEl = document.getElementById(`translation-${index}`);
            if (translationEl) {
              translationEl.textContent = `Terjemahan: ${ayah.text}`;
              const copyBtn = document.querySelector(`#ayah-${index} .copy-btn`);
              if (copyBtn) {
                copyBtn.setAttribute('data-translation', `Terjemahan: ${ayah.text}`);
              }
            }
          });
          // Update transliterasi
          transliterationData.ayahs.forEach((ayah, index) => {
            const latinEl = document.querySelector(`#ayah-${index} .latin`);
            if (latinEl) {
              latinEl.textContent = ayah.text;
              const copyBtn = document.querySelector(`#ayah-${index} .copy-btn`);
              if (copyBtn) {
                copyBtn.setAttribute('data-latin', ayah.text);
              }
            }
          });
          // Tambahkan kontrol audio per ayat
          audioData.ayahs.forEach((ayah, index) => {
            const ayahContainer = document.getElementById(`ayah-${index}`);
            if (ayahContainer && ayah.audio) {
              if (!ayahContainer.querySelector('.audio-player')) {
                const audioPlayer = document.createElement('div');
                audioPlayer.className = 'audio-player';
                audioPlayer.setAttribute('data-audio-url', ayah.audio);
                
                const audioObj = new Audio(ayah.audio);
                audioObj.preload = 'auto';
                
                const playPauseBtn = document.createElement('button');
                playPauseBtn.textContent = 'Play';
                playPauseBtn.addEventListener('click', function () {
                  if (audioObj.paused) {
                    audioObj.play();
                    playPauseBtn.textContent = 'Pause';
                  } else {
                    audioObj.pause();
                    playPauseBtn.textContent = 'Play';
                  }
                });
                
                const rewindBtn = document.createElement('button');
                rewindBtn.textContent = '⏪ 10s';
                rewindBtn.addEventListener('click', function () {
                  audioObj.currentTime = Math.max(0, audioObj.currentTime - 10);
                });
                
                const forwardBtn = document.createElement('button');
                forwardBtn.textContent = '10s ⏩';
                forwardBtn.addEventListener('click', function () {
                  audioObj.currentTime = Math.min(audioObj.duration, audioObj.currentTime + 10);
                });
                
                audioPlayer.appendChild(playPauseBtn);
                audioPlayer.appendChild(rewindBtn);
                audioPlayer.appendChild(forwardBtn);
                ayahContainer.insertBefore(audioPlayer, ayahContainer.querySelector('.controls'));
              }
            }
          });
        })
        .catch(error => {
          console.error('Error mengambil terjemahan:', error);
        });
    }
    
    // Mulai load daftar surah dari API
    fetch('https://api.alquran.cloud/v1/surah')
      .then(response => response.json())
      .then(data => {
        surahList = data.data;
        populateSurahMenu(surahList);
      })
      .catch(error => console.error('Error fetching surah list:', error));
  </script>
</body>
</html>